<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Hostel Management System</title>
    <style>
        :root {
            --primary-color: #241268;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-bg: #d0dee1;
            --white: #ffffff;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --border-color: #bdc3c7;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --root-font-size: 14px;
        }

        /* Light Mode (Default) */
        body {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-bg: #ecf0f1;
            --white: #ffffff;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --border-color: #bdc3c7;
        }

        /* Dark Mode */
        body.dark-mode {
            --primary-color: #7b4da8;
            --secondary-color: #86b6de;
            --success-color: #4caf8f;
            --danger-color: #d16b6b;
            --warning-color: #d68910;
            --light-bg: #2b174c;
            --white: #3b235f;
            --text-dark: #ecf0f1;
            --text-light: #bfaee3;
            --border-color: #5c3b8a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--light-bg);
            color: var(--text-dark);
            font-size: var(--root-font-size);
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease, font-size 0.3s ease;
        }

        body.font-normal {
            --root-font-size: 14px;
        }

        body.font-large {
            --root-font-size: 18px;
        }

        body.font-extra-large {
            --root-font-size: 22px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--primary-color);
            color: var(--white);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        header h1 {
            font-size: 28px;
            margin: 0;
        }

        header .controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button,
        input[type="button"],
        input[type="submit"] {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: inherit;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-primary {
            background-color: var(--secondary-color);
            color: var(--white);
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-success {
            background-color: var(--success-color);
            color: var(--white);
        }

        .btn-success:hover {
            background-color: #229954;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: var(--white);
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: var(--white);
        }

        .btn-warning:hover {
            background-color: #d68910;
        }

        .btn-secondary {
            background-color: #95a5a6;
            color: var(--white);
        }

        .btn-secondary:hover {
            background-color: #7f8c8d;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 12px;
        }

        .role-selection {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .role-card {
            background: var(--white);
            padding: 40px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        .role-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }

        .role-card h2 {
            color: var(--secondary-color);
            margin-bottom: 10px;
        }

        .login-form,
        .register-form {
            background: var(--white);
            padding: 40px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            max-width: 500px;
            margin: 40px auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-dark);
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="phone"],
        input[type="number"],
        input[type="date"],
        input[type="datetime-local"],
        input[type="file"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: inherit;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus,
        input[type="phone"]:focus,
        input[type="number"]:focus,
        input[type="date"]:focus,
        input[type="datetime-local"]:focus,
        input[type="file"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--white);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--secondary-color);
        }

        .card h3 {
            margin: 0 0 10px 0;
            color: var(--primary-color);
        }

        .card-number {
            font-size: 32px;
            font-weight: bold;
            color: var(--secondary-color);
            margin: 10px 0;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-submitted {
            background-color: #e8f4f8;
            color: #0277bd;
        }

        .status-in-progress {
            background-color: #fff3e0;
            color: #e65100;
        }

        .status-resolved {
            background-color: #e8f5e9;
            color: #2e7d32;
        }

        .status-approved {
            background-color: #e8f5e9;
            color: #2e7d32;
        }

        .status-rejected {
            background-color: #ffebee;
            color: #c62828;
        }

        .status-pending {
            background-color: #f3e5f5;
            color: #6a1b9a;
        }

        .list-item {
            background: var(--white);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .list-item-content {
            flex: 1;
            min-width: 200px;
        }

        .list-item h4 {
            margin: 0 0 5px 0;
            color: var(--text-dark);
        }

        .list-item p {
            margin: 5px 0;
            color: var(--text-light);
            font-size: 13px;
        }

        .list-item-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .notification {
            background: var(--white);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            border-left: 4px solid var(--secondary-color);
            display: flex;
            justify-content: space-between;
            align-items: start;
            gap: 10px;
        }

        .notification-content {
            flex: 1;
        }

        .notification-content h4 {
            margin: 0 0 5px 0;
        }

        .notification-content p {
            margin: 5px 0;
            color: var(--text-light);
            font-size: 13px;
        }

        .notification.success {
            border-left-color: var(--success-color);
            background-color: #f0fdf4;
        }

        .notification.error {
            border-left-color: var(--danger-color);
            background-color: #fef2f2;
        }

        .notification.warning {
            border-left-color: var(--warning-color);
            background-color: #fffbeb;
        }

        .notification.info {
            border-left-color: var(--secondary-color);
            background-color: #f0f9ff;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            padding: 30px;
            border-radius: 8px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
        }

        .modal-header h2 {
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-light);
        }

        .close-btn:hover {
            color: var(--text-dark);
        }

        .hidden {
            display: none;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        nav {
            background-color: var(--white);
            padding: 0;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        nav ul {
            list-style: none;
            display: flex;
            align-items: center;
            margin: 0;
            padding: 0;
            flex-wrap: nowrap;
        }

        nav li {
            margin: 0;
        }

        nav button {
            width: 100%;
            padding: 15px;
            border: none;
            background-color: var(--white);
            color: var(--text-dark);
            text-align: left;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        nav button:hover {
            background-color: var(--light-bg);
            border-bottom-color: var(--secondary-color);
        }

        nav button.active {
            background-color: var(--secondary-color);
            color: var(--white);
            border-bottom-color: var(--secondary-color);
            border-left: 4px solid #241268;
            box-sizing: border-box;


        }

        .profile-section {
            background: var(--white);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .profile-header {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .profile-photo {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            object-fit: cover;
            border: 2px solid var(--secondary-color);
        }

        .profile-info {
            flex: 1;
        }

        .profile-info p {
            margin: 8px 0;
        }

        .profile-info strong {
            color: var(--primary-color);
        }

        .section-title {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-color);
            margin: 30px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary-color);
        }

        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .alert-error {
            background-color: #ffebee;
            color: #c62828;
            border-left: 4px solid #c62828;
        }

        .alert-success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #2e7d32;
        }

        .tabs {
            display: flex;
            gap: 0;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 20px;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-light);
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab:hover {
            color: var(--text-dark);
        }

        .tab.active {
            color: var(--secondary-color);
            border-bottom-color: var(--secondary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        input[type="checkbox"],
        input[type="radio"] {
            cursor: pointer;
            width: 18px;
            height: 18px;
        }

        .language-switcher {
            display: flex;
            gap: 10px;
        }

        .language-switcher button {
            padding: 8px 16px;
            font-size: 12px;
        }

        .accessibility-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .accessibility-controls button {
            padding: 8px 16px;
            font-size: 12px;
        }

        .accessibility-controls button.active {
            background-color: var(--success-color) !important;
            color: var(--white) !important;
        }

        .font-size-selector,
        .theme-selector {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .collapsible-header {
            background-color: var(--secondary-color);
            color: var(--white);
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            width: 100%;
            text-align: left;
            margin-bottom: 10px;
            transition: background-color 0.3s ease;
        }

        .collapsible-header:hover {
            background-color: var(--primary-color);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background-color: var(--white);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .collapsible-content.active {
            max-height: 500px;
            padding: 15px;
        }

        .filter-section {
            background: var(--white);
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: end;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
        }

        .empty-state h3 {
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            header {
                flex-direction: column;
                text-align: center;
            }

            header h1 {
                font-size: 24px;
            }

            nav ul {
                flex-wrap: nowrap;
                overflow-x: auto;
            }

            nav button {
                padding: 12px;
                font-size: 13px;
                white-space: nowrap;
                flex-shrink: 0;
            }

            .profile-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 20px;
            }

            .list-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .list-item-actions {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <!-- Role Selection Screen -->
    <div id="rolePage" class="page active">
        <div class="container">
            <header style="text-align: center; margin-top: 40px;">
                <h1>üè• Digital Hostel Management System</h1>
            </header>
            <div class="role-selection">
                <div class="role-card" onclick="selectRole('student')">
                    <h2>üë®‚Äçüéì</h2>
                    <h3>Student Login</h3>
                    <p>Access your hostel dashboard</p>
                    <button class="btn-secondary" onclick="selectRole('student')" style="margin-top: 10px;">Login as
                        Student</button>
                </div>
                <div class="role-card" onclick="selectRole('warden')">
                    <h2>üë®‚Äçüíº</h2>
                    <h3>Warden Login</h3>
                    <p>Manage hostel operations</p>
                    <button class="btn-secondary" onclick="selectRole('warden')" style="margin-top: 10px;">Login as
                        Warden</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Page -->
    <div id="loginPage" class="page">
        <div class="container">
            <header style="text-align: center; margin-top: 20px;">
                <h1 id="loginTitle">Login</h1>
            </header>
            <div class="login-form">
                <div id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">Email or ID</label>
                        <input type="text" id="loginEmail" placeholder="Enter your email or ID" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter password" required>
                    </div>
                    <div class="form-group">
                        <button class="btn-primary" onclick="handleLogin()" style="width: 100%;">Login</button>
                    </div>
                    <div class="form-group" style="text-align: center;">
                        <p id="registerPromptStudent" style="display: none; margin-bottom: 15px;">
                            <button class="btn-sm btn-primary" onclick="showStudentRegisterForm()"
                                style="width: 100%; margin-bottom: 10px;">üìù New Student? Register Here</button>
                        </p>
                        <p id="registerPromptWarden" style="display: none; margin-bottom: 15px;">
                            <button class="btn-sm btn-primary" onclick="showWardenRegisterForm()"
                                style="width: 100%; margin-bottom: 10px;">üìù New Warden? Register Here</button>
                        </p>
                    </div>
                    <div class="form-group" style="text-align: center;">
                        <button class="btn-secondary" onclick="goBackToRole()" style="width: 100%;">Back to Role
                            Selection</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Student Register Page -->
    <div id="studentRegisterPage" class="page">
        <div class="container">
            <header style="text-align: center; margin-top: 20px;">
                <h1>Student Registration</h1>
            </header>
            <div class="register-form">
                <div id="studentRegisterForm" class="grid-2" style="display: block;">
                    <div class="form-group">
                        <label for="studentId">Student ID *</label>
                        <input type="text" id="studentId" required>
                    </div>
                    <div class="form-group">
                        <label for="studentEmail">Email *</label>
                        <input type="email" id="studentEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="fullName">Full Name *</label>
                        <input type="text" id="fullName" required>
                    </div>
                    <div class="form-group">
                        <label for="studentDOB">Date of Birth *</label>
                        <input type="date" id="studentDOB" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number *</label>
                        <input type="text" id="phone" required>
                    </div>
                    <div class="form-group">
                        <label for="parentName">Parent Name *</label>
                        <input type="text" id="parentName" required>
                    </div>
                    <div class="form-group">
                        <label for="parentContact">Parent Contact (Numeric) *</label>
                        <input type="tel" id="parentContact" pattern="[0-9]+" required>
                    </div>
                    <div class="form-group">
                        <label for="college">College Name *</label>
                        <!-- <label for="College Name">College Name *</label> -->
                        <input type="text" id="college" required>
                    </div>
                    <div class="form-group">
                        <label for="department">Department *</label>
                        <input type="text" id="department" required>
                    </div>
                    <div class="form-group">
                        <label for="roomNumber">Room Number *</label>
                        <input type="text" id="roomNumber" required>
                    </div>
                    <div class="form-group">
                        <label for="remainingFee">Remaining Fee (‚Çπ) *</label>
                        <input type="number" id="remainingFee" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="idProof">ID Card/Fee Receipt Photo *</label>
                        <input type="file" id="idProof" accept="image/*" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password *</label>
                        <input type="password" id="registerPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password *</label>
                        <input type="password" id="confirmPassword" required>
                    </div>
                    <div style="grid-column: 1/-1; display: flex; gap: 10px;">
                        <button class="btn-success" onclick="handleStudentRegister()" style="flex: 1;">Register</button>
                        <!-- <button class="btn-secondary" onclick="backToLogin()" style="flex: 1;">Back to Login</button> -->
                        <button class="btn-secondary" onclick="goBackToRole()" style="width: 50%;">Back to
                            Login</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Warden Register Page -->
    <div id="wardenRegisterPage" class="page">
        <div class="container">
            <header style="text-align: center; margin-top: 20px;">
                <h1>Warden Registration</h1>
            </header>
            <div class="register-form">
                <div id="wardenRegisterForm" class="grid-2" style="display: block;">
                    <div class="form-group">
                        <label for="wardenEmployeeId">Employee ID *</label>
                        <input type="text" id="wardenEmployeeId" required>
                    </div>
                    <div class="form-group">
                        <label for="wardenEmail">Email *</label>
                        <input type="email" id="wardenEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="wardenFullName">Full Name *</label>
                        <input type="text" id="wardenFullName" required>
                    </div>
                    <div class="form-group">
                        <label for="wardenPhone">Phone Number *</label>
                        <input type="text" id="wardenPhone" required>
                    </div>
                    <div class="form-group">
                        <label for="wardenDOB">Date of Birth *</label>
                        <input type="date" id="wardenDOB" required>
                    </div>
                    <div class="form-group">
                        <label for="wardenIdCardImage">Employee ID Card Photo *</label>
                        <input type="file" id="wardenIdCardImage" accept="image/*" required>
                    </div>
                    <div class="form-group">
                        <label for="wardenPassword">Password *</label>
                        <input type="password" id="wardenPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="wardenConfirmPassword">Confirm Password *</label>
                        <input type="password" id="wardenConfirmPassword" required>
                    </div>
                    <div style="grid-column: 1/-1; display: flex; gap: 10px;">
                        <button class="btn-success" onclick="handleWardenRegister()" style="flex: 1;">Register</button>
                        <!-- <button class="btn-secondary" onclick="backToLogin()" style="flex: 1;">Back to Login</button> -->
                        <button class="btn-secondary" onclick="goBackToRole()" style="width: 50%;">Back to
                            Login</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="appContainer" class="page">
        <div class="container">
            <!-- Header with Controls -->
            <header>
                <div>
                    <h1 id="appTitle">Hostel Dashboard</h1>
                    <p id="userGreeting" style="margin: 5px 0 0 0; font-size: 14px;"></p>
                </div>
                <div class="controls">
                    <div class="language-switcher">
                        <button class="btn-sm btn-secondary" onclick="changeLanguage('en')">EN</button>
                        <button class="btn-sm btn-secondary" onclick="changeLanguage('hi')">‡§π‡§ø</button>
                        <button class="btn-sm btn-secondary" onclick="changeLanguage('mr')">‡§Æ‡§∞</button>
                    </div>
                    <div class="accessibility-controls">
                        <div class="font-size-selector">
                            <button class="btn-sm btn-secondary" onclick="setFontSize('normal')">A</button>
                            <button class="btn-sm btn-secondary" onclick="setFontSize('large')">A+</button>
                            <button class="btn-sm btn-secondary" onclick="setFontSize('extra-large')">A++</button>
                        </div>
                        <button class="btn-sm btn-secondary" onclick="toggleDarkMode()" id="themeBtn">üåô Dark</button>
                    </div>
                    <button class="btn-danger" onclick="logout()">Logout</button>
                </div>
            </header>

            <!-- Notifications -->
            <div id="notificationsContainer"></div>

            <!-- Student Navigation -->
            <nav id="studentNav" class="hidden">
                <ul style="flex-wrap: nowrap; overflow-x: auto;">
                    <li><button class="nav-btn" onclick="switchTab('dashboard')"
                            data-label="dashboard">Dashboard</button></li>
                    <li><button class="nav-btn" onclick="switchTab('profile')" data-label="profile">Profile</button>
                    <li>
                        <button class="nav-btn" onclick="switchTab('rulebook')">Rule Book</button>
                    </li>
                    </li>
                    <li><button class="nav-btn" onclick="switchTab('status')" data-label="status">Status</button></li>
                    <li><button class="nav-btn" onclick="switchTab('complaint')" data-label="complaint">Register
                            Complaint</button></li>
                    <li><button class="nav-btn" onclick="switchTab('complaints')" data-label="complaints">My
                            Complaints</button></li>
                    <li><button class="nav-btn" onclick="switchTab('leave')" data-label="leave">Leave Request</button>
                    </li>
                    <li><button class="nav-btn" onclick="switchTab('escort')" data-label="escort">Escort
                            Request</button></li>
                    <li><button class="nav-btn" onclick="switchTab('anonymous')" data-label="anonymous">Anonymous
                            Report</button></li>
                </ul>
            </nav>

            <!-- Warden Navigation -->
            <!-- <nav id="wardenNav" class="hidden">
                <ul>
                    <li><button class="nav-btn" onclick="switchTab('dashboard')" data-label="dashboard">Dashboard</button></li>
                    <li><button class="nav-btn" onclick="switchTab('warden-profile')" data-label="profile">Profile</button></li>
                    <li><button class="nav-btn" onclick="switchTab('complaints-manage')" data-label="complaints_manage">Manage Complaints</button></li>
                    <li><button class="nav-btn" onclick="switchTab('leave-manage')" data-label="leave_manage">Approve Leaves</button></li>
                    <li><button class="nav-btn" onclick="switchTab('escort-manage')" data-label="escort_manage">Escort Requests</button></li>
                    <li><button class="nav-btn" onclick="switchTab('anonymous-manage')" data-label="anonymous_manage">Anonymous Reports</button></li>
                    <li><button class="nav-btn" onclick="switchTab('announcements')" data-label="announcements">Announcements</button></li>
                </ul>
            </nav> -->

            <!-- Student Dashboard -->
            <div id="studentDashboard" class="tab-content active">
                <div class="dashboard-grid" id="studentDashboardCards">
                    <div class="card">
                        <h3>üìã Complaints Summary</h3>
                        <div class="card-number" id="complaintsTotal">0</div>
                        <p>Resolved: <span id="complaintsResolved">0</span></p>
                    </div>

                    <div class="card">
                        <h3>üåô Night-out Requests</h3>
                        <div class="card-number" id="nightoutTotal">0</div>
                        <p>Active: <span id="nightoutActive">0</span></p>
                    </div>
                </div>
                <div class="dashboard-grid" id="studentDashboardCards"></div>
                <div class="section-title" style="margin-top: 30px;">üì¢ Announcements</div>
                <div id="announcementsPreview"></div>
                <button class="btn-primary" onclick="switchTab('announcements-view')" style="margin-bottom: 20px;">View
                    All Announcements</button>
                <div class="section-title" data-label="recent_activity">Recent Activity</div>
                <div id="recentActivityList"></div>
            </div>

            <!-- Warden Dashboard -->
            <!-- <div id="wardenDashboard" class="tab-content">
                <div class="dashboard-grid" id="wardenDashboardCards"></div>
                <div class="section-title" style="margin-top: 30px;">üì¢ Announcements</div>
                <div id="wardenAnnouncementsPreview"></div>
                <button class="btn-primary" onclick="switchTab('announcements')" style="margin-bottom: 20px;">View All Announcements</button>
                <div class="section-title">üìã Recent Activities</div>
                <div id="wardenRecentActivities"></div>
            </div> -->

            <!-- Student Profile -->
            <div id="studentProfile" class="tab-content hidden">
                <div class="section-title" data-label="profile_info">Profile Information</div>
                <div class="profile-section" id="studentProfileContent"></div>
            </div>

            <!-- Rule Book -->
            <div id="rulebookTab" class="tab-content hidden">
                <div class="section-title">Rule Book ‚Äî Hostel Conduct & Operations</div>

                <p style="font-size: 13px; color: var(--text-light); margin-bottom: 15px;">
                    Hostel Authority: <strong>STES Hostel Management</strong><br>
                    Last updated: 1/12/2026, 5:54:39 PM
                </p>

                <div class="card" style="white-space: pre-line; line-height: 1.7;">
                    A. Curfew & Attendance
                    ‚Ä¢ Weekday curfew: 21:00 (9:00 PM)
                    ‚Ä¢ Weekend curfew: 21:30 (9:30 PM)
                    ‚Ä¢ Daily attendance at ground floor is mandatory
                    ‚Ä¢ Late return fine: ‚Çπ100 per hour

                    B. Leave & Permissions
                    ‚Ä¢ All night-out requests must be submitted via system
                    ‚Ä¢ Parent contact required
                    ‚Ä¢ Approval is warden‚Äôs discretion

                    C. Conduct & Safety
                    ‚Ä¢ No loud music or violence
                    ‚Ä¢ Drugs, alcohol, smoking prohibited
                    ‚Ä¢ Sharp objects prohibited

                    D. Fire & Festivals
                    ‚Ä¢ Firecrackers prohibited
                    ‚Ä¢ Unsafe celebrations banned

                    E. Appliances & Food
                    ‚Ä¢ Only permitted appliances
                    ‚Ä¢ Kitchen closed after 12 AM
                    ‚Ä¢ No food delivery after 11:30 PM

                    F. Property & Fees
                    ‚Ä¢ Damage fine: ‚Çπ5,000 or actual cost
                    ‚Ä¢ Late fee penalties apply

                    G. Miscellaneous
                    ‚Ä¢ Hostel not responsible for belongings
                    ‚Ä¢ Gates open at 6:00 AM
                    ‚Ä¢ Room allocation by authority

                    H. Enforcement
                    ‚Ä¢ Violations may lead to fines or eviction
                    ‚Ä¢ Rules may be updated anytime
                </div>
            </div>


            <!-- Register Complaint -->
            <div id="registerComplaint" class="tab-content hidden">
                <div class="section-title" data-label="register_complaint">Register New Complaint</div>
                <div class="card" style="max-width: 600px;">
                    <form id="complaintForm">
                        <div class="form-group">
                            <label for="complaintCategory" data-label="category">Category *</label>
                            <select id="complaintCategory" required>
                                <option value="">Select Category</option>
                                <option value="Electrical">Electrical</option>
                                <option value="Hygiene">Hygiene</option>
                                <option value="Water">Water</option>
                                <option value="Plumbing">Plumbing</option>
                                <option value="Furniture">Furniture</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="complaintPriority">Priority *</label>
                            <select id="complaintPriority" required>
                                <option value="">Select Priority</option>
                                <option value="Low">Low</option>
                                <option value="Medium">Medium</option>
                                <option value="High">High</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="complaintDescription" data-label="description">Description *</label>
                            <textarea id="complaintDescription" placeholder="Describe your issue" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="complaintImage" data-label="image">Image (optional)</label>
                            <input type="file" id="complaintImage" accept="image/*">
                        </div>
                        <button type="submit" class="btn-success" style="width: 100%;" data-label="submit">Submit
                            Complaint</button>
                    </form>
                </div>
            </div>

            <!-- Student Complaints -->
            <div id="studentComplaints" class="tab-content hidden">
                <div class="section-title" data-label="my_complaints">My Complaints</div>
                <div class="filter-section">
                    <select id="complaintStatusFilter" onchange="filterComplaints()" style="flex: 1; min-width: 150px;">
                        <option value="">All Status</option>
                        <option value="Submitted">Submitted</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Resolved">Resolved</option>
                    </select>
                </div>
                <div id="complaintsList"></div>
            </div>

            <!-- Leave Request -->
            <div id="leaveRequest" class="tab-content hidden">
                <div class="section-title" data-label="leave_request">Leave Request</div>
                <div class="card" style="max-width: 600px;">
                    <form id="leaveForm">
                        <div class="form-group">
                            <label for="leaveFrom" data-label="from_date">From Date/Time *</label>
                            <input type="datetime-local" id="leaveFrom" required>
                        </div>
                        <div class="form-group">
                            <label for="leaveTo" data-label="to_date">To Date/Time *</label>
                            <input type="datetime-local" id="leaveTo" required>
                        </div>
                        <div class="form-group">
                            <label for="leaveReason" data-label="reason">Reason *</label>
                            <textarea id="leaveReason" placeholder="Enter reason for leave" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="leaveParentContact" data-label="parent_contact">Parent Contact *</label>
                            <input type="text" id="leaveParentContact" required>
                        </div>
                        <button type="submit" class="btn-success" style="width: 100%;" data-label="submit">Submit
                            Request</button>
                    </form>
                </div>
            </div>

            <!-- Anonymous Report -->
            <div id="anonymousReport" class="tab-content hidden">
                <div class="section-title" data-label="anonymous_report">Anonymous Report</div>
                <div class="alert alert-error" data-label="anonymous_note">Your identity will not be revealed. This is
                    for harassment or theft reporting only.</div>
                <div class="card" style="max-width: 600px;">
                    <form id="anonForm">
                        <div class="form-group">
                            <label for="anonType" data-label="type">Report Type *</label>
                            <select id="anonType" required>
                                <option value="">Select Type</option>
                                <option value="Harassment">Harassment</option>
                                <option value="Theft">Theft</option>
                                <option value="Act of Violence">Act of Violence</option>
                                <option value="Sexual Assault">Sexual Assault (SA)</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="anonDescription" data-label="description">Description *</label>
                            <button type="button" class="btn-sm btn-secondary" onclick="showAnonTooltip()"
                                style="margin-bottom: 10px;">‚ÑπÔ∏è Instructions</button>
                            <div id="anonTooltip" class="alert alert-error" style="display: none; margin-bottom: 10px;">
                                <strong>Please include:</strong>
                                <ul style="margin: 10px 0; padding-left: 20px;">
                                    <li>Date and Time of incident.</li>
                                    <li>Exact location/place of occurrence.</li>
                                    <li>Brief description or statement of event.</li>
                                    <li>Physical description of the alleged perpetrator (if known).</li>
                                    <li>Relationship to the alleged offender/accused (if applicable).</li>
                                </ul>
                            </div>
                            <textarea id="anonDescription" placeholder="Describe the incident in detail"
                                required></textarea>
                        </div>
                        <div class="form-group">
                            <label data-label="image">Upload Evidence/Photos (Optional)</label>
                            <input type="file" id="anonEvidenceFiles" accept="image/*" multiple>
                            <div id="anonEvidencePreview"
                                style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;"></div>
                        </div>
                        <button type="submit" class="btn-danger" style="width: 100%;" data-label="submit">Submit
                            Report</button>
                    </form>
                </div>
            </div>

            <!-- Escort Request -->
            <div id="escortRequest" class="tab-content hidden">
                <div class="section-title" data-label="escort_request">Escort/Safe-Walk Request</div>
                <div class="card" style="max-width: 600px;">
                    <form id="escortForm">
                        <div class="form-group">
                            <label for="escortReason" data-label="reason">Reason *</label>
                            <select id="escortReason" required>
                                <option value="">Select Reason</option>
                                <option value="Health Issue">Health Issue</option>
                                <option value="Safety Concern">Safety Concern</option>
                                <option value="Late Night">Late Night Travel</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="escortLocation" data-label="location">Destination *</label>
                            <input type="text" id="escortLocation" placeholder="Where do you need to go?" required>
                        </div>
                        <div class="form-group">
                            <label for="escortTime" data-label="time">Required Time *</label>
                            <input type="datetime-local" id="escortTime" required>
                        </div>
                        <button type="submit" class="btn-warning" style="width: 100%;" data-label="submit">Request
                            Escort</button>
                    </form>
                </div>
            </div>

            <!-- Student Status Page -->
            <div id="studentStatus" class="tab-content hidden">
                <div class="section-title" data-label="request_status">Request Status</div>
                <div id="leaveStatusContent"></div>
                <div id="escortStatusContent" style="margin-top: 30px;"></div>
            </div>

            <!-- Announcements View Page -->
            <div id="announcementsView" class="tab-content hidden">
                <div class="section-title" data-label="announcements">All Announcements</div>
                <button class="btn-secondary" onclick="switchTab('dashboard')" style="margin-bottom: 20px;">Back to
                    Dashboard</button>
                <div id="announcementsFullList"></div>
            </div>

            <!-- Warden Navigation -->
            <nav id="wardenNav" class="hidden">
                <ul>
                    <li><button class="nav-btn" onclick="switchTab('dashboard')"
                            data-label="dashboard">Dashboard</button></li>
                    <li><button class="nav-btn" onclick="switchTab('warden-profile')"
                            data-label="profile">Profile</button></li>
                    <!-- <li><button class="nav-btn" onclick="switchTab('dashboard')"
                            data-label="dashboard">Dashboard</button></li> -->
                    <!-- <button class="nav-btn" onclick="switchTab('warden-profile')"
                            data-label="profile">Profile</button></li> -->
                    <li><button class="nav-btn" onclick="switchTab('complaints-manage')"
                            data-label="complaints_manage">Manage Complaints</button></li>
                    <li><button class="nav-btn" onclick="switchTab('leave-manage')" data-label="leave_manage">Approve
                            Leaves</button></li>
                    <li><button class="nav-btn" onclick="switchTab('escort-manage')" data-label="escort_manage">Escort
                            Requests</button></li>
                    <!-- <li><button class="nav-btn" onclick="switchTab('complaints-manage')"
                            data-label="complaints_manage">Manage Complaints</button></li>
                    <li><button class="nav-btn" onclick="switchTab('leave-manage')" data-label="leave_manage">Approve
                            Leaves</button></li>
                    <li><button class="nav-btn" onclick="switchTab('escort-manage')" data-label="escort_manage">Escort
                            Requests</button></li> -->
                    <li><button class="nav-btn" onclick="switchTab('anonymous-manage')"
                            data-label="anonymous_manage">Anonymous Reports</button></li>
                    <li><button class="nav-btn" onclick="switchTab('announcements')"
                            data-label="announcements">Announcements</button></li>
                    <li><button class="nav-btn" onclick="switchTab('rulebook')" data-label="rulebook"> Rule Book</button> </li>
                </ul>
            </nav>

            <!-- Warden Dashboard -->
            <div id="wardenDashboard" class="tab-content">
                <div class="dashboard-grid" id="wardenDashboardCards"></div>
                <div class="section-title" style="margin-top: 30px;">üì¢ Announcements</div>
                <div id="wardenAnnouncementsPreview"></div>
                <button class="btn-secondary" onclick="switchTab('announcements')" style="margin-bottom: 20px;">View All
                    Announcements</button>
                <div class="section-title">üìã Recent Activities</div>
                <div id="wardenRecentActivities"></div>
            </div>

            <!-- Warden Profile -->
            <div id="wardenProfile" class="tab-content hidden">
                <div class="section-title" data-label="profile_info">Profile Information</div>
                <div class="profile-section" id="wardenProfileContent"></div>
            </div>

            <!-- Warden: Manage Complaints -->
            <div id="manageComplaints" class="tab-content hidden">
                <div class="section-title" data-label="manage_complaints">Manage Complaints</div>
                <div class="filter-section">
                    <select id="wardenComplaintFilter" onchange="filterWardenComplaints()"
                        style="flex: 1; min-width: 150px;">
                        <option value="">All Status</option>
                        <option value="Submitted">Submitted</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Resolved">Resolved</option>
                    </select>
                </div>
                <div id="wardenComplaintsList"></div>
            </div>

            <!-- Warden: Manage Leaves -->
            <div id="manageLeaves" class="tab-content hidden">
                <div class="section-title" data-label="approve_leaves">Approve Leave Requests</div>
                <div class="filter-section">
                    <select id="wardenLeaveFilter" onchange="filterWardenLeaves()" style="flex: 1; min-width: 150px;">
                        <option value="">All Status</option>
                        <option value="Pending">Pending</option>
                        <option value="Approved">Approved</option>
                        <option value="Rejected">Rejected</option>
                    </select>
                </div>
                <div id="wardenLeavesList"></div>
            </div>

            <!-- Warden: Manage Escorts -->
            <div id="manageEscorts" class="tab-content hidden">
                <div class="section-title" data-label="escort_requests">Escort Requests</div>
                <div id="wardenEscortsList"></div>
            </div>

            <!-- Warden: Manage Anonymous Reports -->
            <div id="manageAnonymous" class="tab-content hidden">
                <div class="section-title" data-label="anonymous_reports">Anonymous Reports</div>
                <div id="wardenAnonymousList"></div>
            </div>

            <!-- Warden: Announcements -->
            <div id="announcements" class="tab-content hidden">
                <div class="section-title" data-label="announcements">Post Announcements</div>
                <div class="card" style="max-width: 600px; margin-bottom: 30px;">
                    <form id="announcementForm">
                        <div class="form-group">
                            <label for="announcementTitle" data-label="title">Title *</label>
                            <input type="text" id="announcementTitle" required>
                        </div>
                        <div class="form-group">
                            <label for="announcementText" data-label="content">Content *</label>
                            <textarea id="announcementText" placeholder="Enter announcement" required></textarea>
                        </div>
                        <button type="submit" class="btn-success" style="width: 100%;" data-label="post">Post
                            Announcement</button>
                    </form>
                </div>
                <div class="section-title" data-label="recent_announcements">Recent Announcements</div>
                <div id="announcementsList"></div>
            </div>
        </div>
    </div>

    <!-- Complaint Detail Modal -->
    <div id="complaintModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-label="complaint_details">Complaint Details</h2>
                <button class="close-btn" onclick="closeModal('complaintModal')">&times;</button>
            </div>
            <div id="complaintModalContent"></div>
        </div>
    </div>

    <!-- Leave Detail Modal -->
    <div id="leaveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-label="leave_details">Leave Request Details</h2>
                <button class="close-btn" onclick="closeModal('leaveModal')">&times;</button>
            </div>
            <div id="leaveModalContent"></div>
        </div>
    </div>

    <script>
        // ================= BACKEND CONFIG =================
        const API_BASE = "https://hostel-backend-production-9c02.up.railway.app";


        // ========== TRANSLATIONS ==========
        const translations = {
            en: {
                dashboard: 'Dashboard',
                profile: 'Profile',
                complaint: 'Register Complaint',
                complaints: 'My Complaints',
                status: 'Request Status',
                anonymous: 'Anonymous Report',
                profile_pic: 'Upload Photo',
                fees: 'Payment Status',
                complaints_manage: 'Manage Complaints',
                leave_manage: 'Approve Leaves',
                escort_manage: 'Escort Requests',
                anonymous_manage: 'Anonymous Reports',
                announcements: 'Announcements',
                register_complaint: 'Register New Complaint',
                category: 'Category',
                priority: 'Priority',
                description: 'Description',
                image: 'Image (optional)',
                submit: 'Submit',
                my_complaints: 'My Complaints',
                leave_request: 'Leave Request',
                from_date: 'From Date/Time',
                to_date: 'To Date/Time',
                reason: 'Reason',
                parent_contact: 'Parent Contact',
                anonymous_report: 'Anonymous Report',
                anonymous_note: 'Your identity will not be revealed. This is for harassment or theft reporting only.',
                type: 'Report Type',
                escort_request: 'Escort/Safe-Walk Request',
                location: 'Destination',
                time: 'Required Time',
                payment_status: 'Payment Status',
                manage_complaints: 'Manage Complaints',
                approve_leaves: 'Approve Leave Requests',
                escort_requests: 'Escort Requests',
                anonymous_reports: 'Anonymous Reports',
                title: 'Title',
                content: 'Content',
                post: 'Post',
                recent_announcements: 'Recent Announcements',
                complaint_details: 'Complaint Details',
                leave_details: 'Leave Request Details',
                profile_info: 'Profile Information',
                recent_activity: 'Recent Activity',
                quick_stats: 'Quick Statistics',
                status: 'Status',
                pending: 'Pending',
                approved: 'Approved',
                resolved: 'Resolved',
                submitted: 'Submitted',
                in_progress: 'In Progress'
            },
            hi: {
                dashboard: '‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°',
                profile: '‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤',
                complaint: '‡§∂‡§ø‡§ï‡§æ‡§Ø‡§§ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç',
                complaints: '‡§Æ‡•á‡§∞‡•Ä ‡§∂‡§ø‡§ï‡§æ‡§Ø‡§§‡•á‡§Ç',
                leave: '‡§õ‡•Å‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß',
                anonymous: '‡§ó‡•Å‡§Æ‡§®‡§æ‡§Æ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü',
                escort: '‡§è‡§∏‡•ç‡§ï‡•â‡§∞‡•ç‡§ü ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß',
                fees: '‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∏‡•ç‡§•‡§ø‡§§‡§ø',
                complaints_manage: '‡§∂‡§ø‡§ï‡§æ‡§Ø‡§§‡•á‡§Ç ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç',
                leave_manage: '‡§õ‡•Å‡§ü‡•ç‡§ü‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§Æ‡§Ç‡§ú‡•Ç‡§∞‡•Ä ‡§¶‡•á‡§Ç',
                escort_manage: '‡§è‡§∏‡•ç‡§ï‡•â‡§∞‡•ç‡§ü ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß',
                anonymous_manage: '‡§ó‡•Å‡§Æ‡§®‡§æ‡§Æ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü',
                announcements: '‡§ò‡•ã‡§∑‡§£‡§æ‡§è‡§Ç',
                register_complaint: '‡§®‡§à ‡§∂‡§ø‡§ï‡§æ‡§Ø‡§§ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç',
                category: '‡§∂‡•ç‡§∞‡•á‡§£‡•Ä',
                priority: '‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ',
                description: '‡§µ‡§ø‡§µ‡§∞‡§£',
                image: '‡§ö‡§ø‡§§‡•ç‡§∞ (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)',
                submit: '‡§ú‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç',
                my_complaints: '‡§Æ‡•á‡§∞‡•Ä ‡§∂‡§ø‡§ï‡§æ‡§Ø‡§§‡•á‡§Ç',
                leave_request: '‡§õ‡•Å‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß',
                from_date: '‡§§‡§æ‡§∞‡•Ä‡§ñ/‡§∏‡§Æ‡§Ø ‡§∏‡•á',
                to_date: '‡§§‡§æ‡§∞‡•Ä‡§ñ/‡§∏‡§Æ‡§Ø ‡§§‡§ï',
                reason: '‡§ï‡§æ‡§∞‡§£',
                parent_contact: '‡§Æ‡§æ‡§§‡§æ-‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï',
                anonymous_report: '‡§ó‡•Å‡§Æ‡§®‡§æ‡§Æ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü',
                anonymous_note: '‡§Ü‡§™‡§ï‡•Ä ‡§™‡§π‡§ö‡§æ‡§® ‡§ï‡§æ ‡§ñ‡•Å‡§≤‡§æ‡§∏‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§ ‡§Ø‡§π ‡§ï‡•á‡§µ‡§≤ ‡§â‡§§‡•ç‡§™‡•Ä‡§°‡§º‡§® ‡§Ø‡§æ ‡§ö‡•ã‡§∞‡•Ä ‡§ï‡•Ä ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡•à‡•§',
                type: '‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞',
                escort_request: '‡§è‡§∏‡•ç‡§ï‡•â‡§∞‡•ç‡§ü/‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ö‡§≤‡§®‡§æ ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß',
                location: '‡§ó‡§Ç‡§§‡§µ‡•ç‡§Ø',
                time: '‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§∏‡§Æ‡§Ø',
                payment_status: '‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§∏‡•ç‡§•‡§ø‡§§‡§ø',
                manage_complaints: '‡§∂‡§ø‡§ï‡§æ‡§Ø‡§§‡•á‡§Ç ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç',
                approve_leaves: '‡§õ‡•Å‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß‡•ã‡§Ç ‡§ï‡•ã ‡§Æ‡§Ç‡§ú‡•Ç‡§∞‡•Ä ‡§¶‡•á‡§Ç',
                escort_requests: '‡§è‡§∏‡•ç‡§ï‡•â‡§∞‡•ç‡§ü ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß',
                anonymous_reports: '‡§ó‡•Å‡§Æ‡§®‡§æ‡§Æ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü',
                title: '‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï',
                content: '‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä',
                post: '‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç',
                recent_announcements: '‡§π‡§æ‡§≤ ‡§ï‡•Ä ‡§ò‡•ã‡§∑‡§£‡§æ‡§è‡§Ç',
                complaint_details: '‡§∂‡§ø‡§ï‡§æ‡§Ø‡§§ ‡§µ‡§ø‡§µ‡§∞‡§£',
                leave_details: '‡§õ‡•Å‡§ü‡•ç‡§ü‡•Ä ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§µ‡§ø‡§µ‡§∞‡§£',
                profile_info: '‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä',
                recent_activity: '‡§π‡§æ‡§≤ ‡§ï‡•Ä ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø',
                quick_stats: '‡§§‡•ç‡§µ‡§∞‡§ø‡§§ ‡§∏‡§æ‡§Ç‡§ñ‡•ç‡§Ø‡§ø‡§ï‡•Ä',
                status: '‡§∏‡•ç‡§•‡§ø‡§§‡§ø',
                pending: '‡§≤‡§Ç‡§¨‡§ø‡§§',
                approved: '‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§',
                resolved: '‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ',
                submitted: '‡§ú‡§Æ‡§æ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ',
                in_progress: '‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§Æ‡•á‡§Ç'
            },
            mr: {
                dashboard: '‡§°‡•Ö‡§∂‡§¨‡•ã‡§∞‡•ç‡§°',
                profile: '‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤',
                complaint: '‡§§‡§ï‡•ç‡§∞‡§æ‡§∞ ‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä ‡§ï‡§∞‡§æ',
                complaints: '‡§Æ‡§æ‡§ù‡•ç‡§Ø‡§æ ‡§§‡§ï‡•ç‡§∞‡§æ‡§∞‡•Ä',
                leave: '‡§∞‡§ú‡•á‡§ö‡§æ ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß',
                anonymous: '‡§ó‡•Å‡§Æ‡§®‡§æ‡§Æ ‡§Ö‡§π‡§µ‡§æ‡§≤',
                escort: '‡§è‡§∏‡•ç‡§ï‡•â‡§∞‡•ç‡§ü ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß',
                fees: '‡§≠‡§∞‡§£‡§æ ‡§ï‡•á‡§≤‡•á‡§≤‡•ç‡§Ø‡§æ ‡§™‡•à‡§∂‡§æ‡§ö‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡•Ä',
                complaints_manage: '‡§§‡§ï‡•ç‡§∞‡§æ‡§∞‡•Ä ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞‡§æ',
                leave_manage: '‡§∞‡§ú‡•á ‡§Æ‡§Ç‡§ú‡•Ç‡§∞ ‡§ï‡§∞‡§æ',
                escort_manage: '‡§è‡§∏‡•ç‡§ï‡•â‡§∞‡•ç‡§ü ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß',
                anonymous_manage: '‡§ó‡•Å‡§Æ‡§®‡§æ‡§Æ ‡§Ö‡§π‡§µ‡§æ‡§≤',
                announcements: '‡§ò‡•ã‡§∑‡§£‡§æ',
                register_complaint: '‡§®‡§µ‡•Ä‡§® ‡§§‡§ï‡•ç‡§∞‡§æ‡§∞ ‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä ‡§ï‡§∞‡§æ',
                category: '‡§∂‡•ç‡§∞‡•á‡§£‡•Ä',
                priority: '‡§™‡•ç‡§∞‡§æ‡§ß‡§æ‡§®‡•ç‡§Ø',
                description: '‡§µ‡§∞‡•ç‡§£‡§®',
                image: '‡§™‡•ç‡§∞‡§§‡§ø‡§Æ‡§æ (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)',
                submit: '‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡§æ',
                my_complaints: '‡§Æ‡§æ‡§ù‡•ç‡§Ø‡§æ ‡§§‡§ï‡•ç‡§∞‡§æ‡§∞‡•Ä',
                leave_request: '‡§∞‡§ú‡•á‡§ö‡§æ ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß',
                from_date: '‡§§‡§æ‡§∞‡•Ä‡§ñ/‡§µ‡•á‡§≥ ‡§™‡§æ‡§∏‡•Ç‡§®',
                to_date: '‡§§‡§æ‡§∞‡•Ä‡§ñ/‡§µ‡•á‡§≥ ‡§™‡§∞‡•ç‡§Ø‡§Ç‡§§',
                reason: '‡§ï‡§æ‡§∞‡§£',
                parent_contact: '‡§™‡§æ‡§≤‡§ï‡§æ‡§ö‡§æ ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï',
                anonymous_report: '‡§ó‡•Å‡§Æ‡§®‡§æ‡§Æ ‡§Ö‡§π‡§µ‡§æ‡§≤',
                anonymous_note: '‡§Ü‡§™‡§≤‡•Ä ‡§ì‡§≥‡§ñ ‡§â‡§ò‡§° ‡§ï‡•á‡§≤‡•Ä ‡§ú‡§æ‡§£‡§æ‡§∞ ‡§®‡§æ‡§π‡•Ä‡•§ ‡§π‡•á ‡§ï‡•á‡§µ‡§≥ ‡§õ‡§≥ ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§ö‡•ã‡§∞‡•Ä‡§ö‡§æ ‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§¶‡•á‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§Ü‡§π‡•á‡•§',
                type: '‡§Ö‡§π‡§µ‡§æ‡§≤ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞',
                escort_request: '‡§è‡§∏‡•ç‡§ï‡•â‡§∞‡•ç‡§ü/‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§ö‡§æ‡§≤ ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß',
                location: '‡§ó‡§Ç‡§§‡§µ‡•ç‡§Ø',
                time: '‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§µ‡•á‡§≥',
                payment_status: '‡§≠‡§∞‡§£‡§æ ‡§ï‡•á‡§≤‡•á‡§≤‡•ç‡§Ø‡§æ ‡§™‡•à‡§∂‡§æ‡§ö‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡•Ä',
                manage_complaints: '‡§§‡§ï‡•ç‡§∞‡§æ‡§∞‡•Ä ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞‡§æ',
                approve_leaves: '‡§∞‡§ú‡•á‡§ö‡•á ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§Æ‡§Ç‡§ú‡•Ç‡§∞ ‡§ï‡§∞‡§æ',
                escort_requests: '‡§è‡§∏‡•ç‡§ï‡•â‡§∞‡•ç‡§ü ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß',
                anonymous_reports: '‡§ó‡•Å‡§Æ‡§®‡§æ‡§Æ ‡§Ö‡§π‡§µ‡§æ‡§≤',
                title: '‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï',
                content: '‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä',
                post: '‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡§æ',
                recent_announcements: '‡§Ö‡§≤‡§ø‡§ï‡§°‡•Ä‡§≤ ‡§ò‡•ã‡§∑‡§£‡§æ',
                complaint_details: '‡§§‡§ï‡•ç‡§∞‡§æ‡§∞ ‡§§‡§™‡§∂‡•Ä‡§≤',
                leave_details: '‡§∞‡§ú‡§æ ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§§‡§™‡§∂‡•Ä‡§≤',
                profile_info: '‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä',
                recent_activity: '‡§Ö‡§≤‡§ø‡§ï‡§°‡•Ä‡§≤ ‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§ï‡§≤‡§æ‡§™',
                quick_stats: '‡§¶‡•ç‡§∞‡•Å‡§§ ‡§Ü‡§ï‡§°‡•á‡§µ‡§æ‡§∞‡•Ä',
                status: '‡§∏‡•ç‡§•‡§ø‡§§‡•Ä',
                pending: '‡§™‡•ç‡§∞‡§≤‡§Ç‡§¨‡§ø‡§§',
                approved: '‡§Æ‡§Ç‡§ú‡•Ç‡§∞',
                resolved: '‡§∏‡•ã‡§°‡§µ‡§≤‡•á',
                submitted: '‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡•á‡§≤‡•á',
                in_progress: '‡§™‡•ç‡§∞‡§ó‡§§‡•Ä‡§ö‡•ç‡§Ø‡§æ ‡§Ö‡§µ‡§∏‡•ç‡§•‡•á‡§§'
            }
        };

        let currentLanguage = localStorage.getItem('language') || 'en';

        // ========== STATE MANAGEMENT ==========
        let currentUser = null;
        let userRole = null;

        // Initialize localStorage with pre-seeded warden account
        function initializeApp() {
            const escorts = JSON.parse(localStorage.getItem('escorts')) || [];
            const myEscorts = escorts.filter(e => e.studentId === currentUser.id);




            if (!localStorage.getItem('leaves')) {
                localStorage.setItem('leaves', JSON.stringify([]));
            }

            if (!localStorage.getItem('escorts')) {
                localStorage.setItem('escorts', JSON.stringify([]));
            }

            if (!localStorage.getItem('anonymousReports')) {
                localStorage.setItem('anonymousReports', JSON.stringify([]));
            }

            if (!localStorage.getItem('notifications')) {
                localStorage.setItem('notifications', JSON.stringify([]));
            }

            if (!localStorage.getItem('announcements')) {
                localStorage.setItem('announcements', JSON.stringify([]));
            }

            applyAccessibilitySettings();
        }

        // ========== ROLE SELECTION ==========
        function selectRole(role) {
            userRole = role;
            showPage('loginPage');
            updateUI();
        }

        function goBackToRole() {
            userRole = null;
            showPage('rolePage');
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
        }

        // ========== AUTHENTICATION ==========
        function handleLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value.trim();

            if (!email || !password) {
                alert('Please enter both email/ID and password');
                return;
            }

            const users = JSON.parse(localStorage.getItem('users')) || [];
            const user = users.find(u => (u.email === email || u.id === email) && u.password === password && u.role === userRole);

            if (user) {
                currentUser = user;
                showPage('appContainer');
                if (userRole === 'student') {
                    document.getElementById('registerPrompt')?.style.remove();
                    if (!user.idProof) {
                        alert('Please complete your profile first');
                    }
                }
                renderDashboard();
                updateUI();

                // Auto-switch to dashboard for warden users immediately after login
                if (userRole === 'warden') {
                    switchTab('dashboard');
                    loadWardenRecentActivities();
                }
            } else {
                alert('Invalid credentials for ' + userRole);
            }
        }

        function showStudentRegisterForm() {
            showPage('studentRegisterPage');
        }

        function showWardenRegisterForm() {
            showPage('wardenRegisterPage');
        }

        function backToLogin() {
            clearRegisterForm();
            // Return to login page while preserving role selection, language, font size, and theme
            // These settings are stored in localStorage and will be maintained automatically
            if (userRole === 'student' || userRole === 'warden') {
                showPage('loginPage');
                updateUI();
            } else {
                goBackToRole();
            }
        }

        function handleStudentRegister() {
            const studentId = document.getElementById('studentId').value.trim();
            const studentEmail = document.getElementById('studentEmail').value.trim();
            const fullName = document.getElementById('fullName').value.trim();
            const studentDOB = document.getElementById('studentDOB').value;
            const phone = document.getElementById('phone').value.trim();
            const parentName = document.getElementById('parentName').value.trim();
            const parentContact = document.getElementById('parentContact').value.trim();
            const college = document.getElementById('college').value.trim();
            const department = document.getElementById('department').value.trim();
            const roomNumber = document.getElementById('roomNumber').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const idProofFile = document.getElementById('idProof').files[0];

            // Validation
            if (!studentId || !studentEmail || !fullName || !studentDOB || !phone || !parentName || !parentContact || !college || !department || !roomNumber || !password || !confirmPassword || !idProofFile) {
                alert('Please fill all required fields');
                return;
            }

            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }

            if (!parentContact.match(/^[0-9]{10}$/)) {
                alert('Parent contact must be a valid 10-digit number');
                return;
            }

            if (idProofFile.size > 5 * 1024 * 1024) {
                alert('Image file size should be less than 5MB');
                return;
            }

            // Convert image to Base64
            const reader = new FileReader();
            reader.onload = function (e) {
                const users = JSON.parse(localStorage.getItem('users')) || [];

                // Check if student already exists
                if (users.find(u => u.id === studentId || u.email === studentEmail)) {
                    alert('Student ID or email already registered');
                    return;
                }

                const newUser = {
                    id: studentId,
                    role: 'student',
                    email: studentEmail,
                    password: password,
                    name: fullName,
                    dob: studentDOB,
                    phone: phone,
                    parentName: parentName,
                    parentContact: parentContact,
                    college: college,
                    department: department,
                    roomNumber: roomNumber,
                    remainingFee: 0,
                    idProof: e.target.result, // Base64 encoded image
                    profilePicture: null,
                    registeredAt: new Date().toISOString()
                };

                users.push(newUser);
                localStorage.setItem('users', JSON.stringify(users));

                alert('Registration successful! Please login with your Student ID or Email');
                clearRegisterForm();
                showPage('loginPage');
            };
            reader.readAsDataURL(idProofFile);
        }

        function handleWardenRegister() {
            const employeeId = document.getElementById('wardenEmployeeId').value.trim();
            const wardenEmail = document.getElementById('wardenEmail').value.trim();
            const fullName = document.getElementById('wardenFullName').value.trim();
            const phone = document.getElementById('wardenPhone').value.trim();
            const wardenDOB = document.getElementById('wardenDOB').value;
            const password = document.getElementById('wardenPassword').value;
            const confirmPassword = document.getElementById('wardenConfirmPassword').value;
            const idCardFile = document.getElementById('wardenIdCardImage').files[0];

            // Validation
            if (!employeeId || !wardenEmail || !fullName || !phone || !wardenDOB || !password || !confirmPassword || !idCardFile) {
                alert('Please fill all required fields');
                return;
            }

            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }

            if (idCardFile.size > 5 * 1024 * 1024) {
                alert('Image file size should be less than 5MB');
                return;
            }

            // Convert image to Base64
            const reader = new FileReader();
            reader.onload = function (e) {
                const users = JSON.parse(localStorage.getItem('users')) || [];

                // Check if warden already exists
                if (users.find(u => u.id === employeeId || u.email === wardenEmail)) {
                    alert('Employee ID or email already registered');
                    return;
                }

                const newWarden = {
                    id: employeeId,
                    role: 'warden',
                    email: wardenEmail,
                    password: password,
                    name: fullName,
                    phone: phone,
                    dob: wardenDOB,
                    idCardImage: e.target.result, // Base64 encoded ID card
                    profilePicture: null,
                    registeredAt: new Date().toISOString()
                };

                users.push(newWarden);
                localStorage.setItem('users', JSON.stringify(users));

                alert('Registration successful! Please login with your Employee ID or Email');
                clearRegisterForm();
                showPage('loginPage');
            };
            reader.readAsDataURL(idCardFile);
        }

        function clearRegisterForm() {
            document.getElementById('studentRegisterForm')?.reset();
            document.getElementById('wardenRegisterForm')?.reset();
        }

        // ========== PAGE NAVIGATION ==========
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');

            // Update registration prompts visibility when switching to login page
            if (pageId === 'loginPage') {
                if (userRole === 'student') {
                    document.getElementById('registerPromptStudent').style.display = 'block';
                    document.getElementById('registerPromptWarden').style.display = 'none';
                } else if (userRole === 'warden') {
                    document.getElementById('registerPromptStudent').style.display = 'none';
                    document.getElementById('registerPromptWarden').style.display = 'block';
                }
            }
        }

        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
                tab.classList.add('hidden');
            });

            // Show selected tab
            if (userRole === 'student') {
                if (tabName === 'dashboard') { document.getElementById('studentDashboard').classList.add('active'); renderStudentDashboard(); }
                else if (tabName === 'profile') { document.getElementById('studentProfile').classList.add('active'); loadStudentProfile(); }
                else if (tabName === 'rulebook') {
                    document.getElementById('rulebookTab').classList.add('active');
                }
                else if (tabName === 'status') { document.getElementById('studentStatus').classList.add('active'); loadRequestStatus(); }
                else if (tabName === 'complaint') document.getElementById('registerComplaint').classList.add('active');
                else if (tabName === 'complaints') { document.getElementById('studentComplaints').classList.add('active'); loadStudentComplaints(); }
                else if (tabName === 'anonymous') document.getElementById('anonymousReport').classList.add('active');
                else if (tabName === 'leave') document.getElementById('leaveRequest').classList.add('active');
                else if (tabName === 'escort') document.getElementById('escortRequest').classList.add('active');
                else if (tabName === 'announcements-view') { document.getElementById('announcementsView').classList.add('active'); loadAllAnnouncements(); }
            } else if (userRole === 'warden') {
                if (tabName === 'dashboard') { document.getElementById('wardenDashboard').classList.add('active'); renderWardenDashboard(); }
                else if (tabName === 'warden-profile') { document.getElementById('wardenProfile').classList.add('active'); loadWardenProfile(); }
                else if (tabName === 'rulebook') {
                    document.getElementById('rulebookTab').classList.add('active');
                }
                else if (tabName === 'complaints-manage') { document.getElementById('manageComplaints').classList.add('active'); loadWardenComplaints(); }
                else if (tabName === 'leave-manage') { document.getElementById('manageLeaves').classList.add('active'); loadWardenLeaves(); }
                else if (tabName === 'escort-manage') { document.getElementById('manageEscorts').classList.add('active'); loadWardenEscorts(); }
                else if (tabName === 'anonymous-manage') { document.getElementById('manageAnonymous').classList.add('active'); loadWardenAnonymous(); }
                else if (tabName === 'announcements') { document.getElementById('announcements').classList.add('active'); loadAnnouncements(); }
            }
            // Update nav button states
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.nav-btn[onclick*="${tabName}"]`)?.classList.add('active');
        }

        function logout() {
            currentUser = null;
            userRole = null;
            showPage('rolePage');
            clearAllForms();
            updateUI();
        }

        function clearAllForms() {
            document.getElementById('loginForm').reset();
            document.getElementById('complaintForm').reset();
            document.getElementById('leaveForm').reset();
            document.getElementById('anonForm').reset();
            document.getElementById('escortForm').reset();
        }

        // ========== UI UPDATES ==========
        function updateUI() {
            const studentNav = document.getElementById('studentNav');
            const wardenNav = document.getElementById('wardenNav');

            if (userRole === 'student') {
                studentNav.classList.remove('hidden');
                wardenNav.classList.add('hidden');
                document.getElementById('appTitle').textContent = 'üë®‚Äçüéì Student Dashboard';
                // Show student registration prompt on login page
                if (document.getElementById('loginPage').classList.contains('active')) {
                    document.getElementById('registerPromptStudent').style.display = 'block';
                    document.getElementById('registerPromptWarden').style.display = 'none';
                }
            } else if (userRole === 'warden') {
                wardenNav.classList.remove('hidden');
                studentNav.classList.add('hidden');
                document.getElementById('appTitle').textContent = 'üë®‚Äçüíº Warden Dashboard';
                // Show warden registration prompt on login page
                if (document.getElementById('loginPage').classList.contains('active')) {
                    document.getElementById('registerPromptStudent').style.display = 'none';
                    document.getElementById('registerPromptWarden').style.display = 'block';
                }
            }

            if (currentUser) {
                document.getElementById('userGreeting').textContent = `Welcome, ${currentUser.name || currentUser.email}!`;
            }

            updateTranslations();
            updateFontSizeButtons();
            updateThemeButton();
            renderDashboard();
        }

        function updateTranslations() {
            document.querySelectorAll('[data-label]').forEach(element => {
                const label = element.getAttribute('data-label');
                const translation = translations[currentLanguage][label];
                if (translation) {
                    if (element.tagName === 'BUTTON' || element.tagName === 'LABEL') {
                        element.textContent = translation;
                    } else if (element.tagName === 'A') {
                        element.textContent = translation;
                    }
                }
            });
        }

        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('language', lang);
            updateTranslations();
        }

        // ========== ACCESSIBILITY ==========
        function setFontSize(size) {
            document.body.classList.remove('font-normal', 'font-large', 'font-extra-large');

            if (size === 'normal') {
                document.body.classList.add('font-normal');
            } else if (size === 'large') {
                document.body.classList.add('font-large');
            } else if (size === 'extra-large') {
                document.body.classList.add('font-extra-large');
            }

            localStorage.setItem('fontSize', size);
            updateFontSizeButtons();
        }

        function updateFontSizeButtons() {
            const buttons = document.querySelectorAll('.font-size-selector button');
            buttons.forEach(btn => btn.classList.remove('active'));

            const currentSize = localStorage.getItem('fontSize') || 'normal';
            if (currentSize === 'normal') buttons[0]?.classList.add('active');
            else if (currentSize === 'large') buttons[1]?.classList.add('active');
            else if (currentSize === 'extra-large') buttons[2]?.classList.add('active');
        }

        function toggleDarkMode() {
            const isDarkMode = document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);
            updateThemeButton();
        }

        function updateThemeButton() {
            const btn = document.getElementById('themeBtn');
            if (document.body.classList.contains('dark-mode')) {
                btn.textContent = '‚òÄÔ∏è Light';
            } else {
                btn.textContent = 'üåô Dark';
            }
        }

        function applyAccessibilitySettings() {
            const fontSize = localStorage.getItem('fontSize') || 'normal';
            setFontSize(fontSize);

            const darkMode = localStorage.getItem('darkMode') === 'true';
            if (darkMode) {
                document.body.classList.add('dark-mode');
            }
            updateThemeButton();
        }

        // ========== COMPLAINTS ==========
        function renderDashboard() {
            if (userRole === 'student') {
                renderStudentDashboard();
            } else if (userRole === 'warden') {
                renderWardenDashboard();
                loadWardenRecentActivities();
            }
        }

        async function renderStudentDashboard() {
            if (!currentUser) return;

            try {
                // fetch complaints from DB
                const cRes = await fetch(`${API_BASE}/complaints/${currentUser.id}`);
                const complaints = await cRes.json();

                // fetch night-outs from DB
                const nRes = await fetch(`${API_BASE}/nightout/${currentUser.id}`);
                const nightouts = await nRes.json();

                const totalComplaints = complaints.length;
                const resolvedComplaints = complaints.filter(c => c.status === "Resolved").length;

                const totalNightouts = nightouts.length;
                const activeNightouts = nightouts.filter(n =>
                    n.status === "Pending" || n.status === "Approved"
                ).length;

                document.getElementById('studentDashboardCards').innerHTML = `
            <div class="card">
                <h3>üìã Complaints Summary</h3>
                <div class="card-number">${totalComplaints}</div>
                <p>Resolved: ${resolvedComplaints}</p>
            </div>
            <div class="card">
                <h3>üåô Night-out Requests</h3>
                <div class="card-number">${totalNightouts}</div>
                <p>Active: ${activeNightouts}</p>
            </div>
        `;

                loadAnnouncementsPreview();
                loadStudentActivityFeed();

            } catch (err) {
                console.error("Student dashboard error:", err);
            }
        }


        async function loadRequestStatus() {
            if (!currentUser) return;

            /* ================= NIGHT-OUT STATUS (FROM DB) ================= */
            let leaveHtml = '<div class="section-title" style="margin-top: 0; margin-bottom: 15px;">Night-out Request Status</div>';

            try {
                const res = await fetch(`${API_BASE}/nightout/${currentUser.id}`);
                const leaves = await res.json();

                if (!Array.isArray(leaves) || leaves.length === 0) {
                    leaveHtml += '<div class="empty-state"><p>No night-out requests</p></div>';
                } else {
                    leaveHtml += leaves.map(leave => `
                <div class="list-item">
                    <div class="list-item-content">
                        <h4>${new Date(leave.from_date).toLocaleString()} ‚Üí ${new Date(leave.to_date).toLocaleString()}</h4>
                        <p><strong>Reason:</strong> ${leave.reason}</p>
                        <p>
                            <strong>Status:</strong>
                            <span class="status-badge status-${leave.status.toLowerCase()}">
                                ${leave.status}
                            </span>
                        </p>
                        <p style="font-size: 12px;">
                            Submitted: ${new Date(leave.created_at).toLocaleString()}
                        </p>
                    </div>
                </div>
            `).join('');
                }
            } catch (err) {
                console.error(err);
                leaveHtml += '<div class="empty-state"><p>Failed to load night-out requests</p></div>';
            }

            /* ================= ESCORT STATUS (FROM DB) ================= */
            let escortHtml = '<div class="section-title" style="margin-bottom: 15px;">Escort Request Status</div>';

            try {
                const res = await fetch(`${API_BASE}/escorts/student/${currentUser.id}`);
                const escorts = await res.json();

                if (!Array.isArray(escorts) || escorts.length === 0) {
                    escortHtml += '<div class="empty-state"><p>No escort requests</p></div>';
                } else {
                    escortHtml += escorts.map(escort => `
                <div class="list-item">
                    <div class="list-item-content">
                        <h4>Escort Request #${escort.id}</h4>
                        <p><strong>Reason:</strong> ${escort.reason}</p>
                        <p><strong>Destination:</strong> ${escort.location}</p>
                        <p><strong>Required Time:</strong> ${new Date(escort.time).toLocaleString()}</p>
                        <p>
                            <strong>Status:</strong>
                            <span class="status-badge status-${escort.status.toLowerCase()}">
                                ${escort.status}
                            </span>
                        </p>
                        <p style="font-size: 12px;">
                            Submitted: ${new Date(escort.created_at).toLocaleString()}
                        </p>
                    </div>
                </div>
            `).join('');
                }
            } catch (err) {
                console.error(err);
                escortHtml += '<div class="empty-state"><p>Failed to load escort requests</p></div>';
            }

            document.getElementById('leaveStatusContent').innerHTML = leaveHtml;
            document.getElementById('escortStatusContent').innerHTML = escortHtml;
        }


        async function renderWardenDashboard() {
            try {
                const cRes = await fetch(`${API_BASE}/complaints`);
                const complaints = await cRes.json();

                const nRes = await fetch(`${API_BASE}/nightout`);
                const nightouts = await nRes.json();

                const pendingComplaints = complaints.filter(c => c.status === "Submitted").length;
                const resolvedComplaints = complaints.filter(c => c.status === "Resolved").length;

                const studentsOut = nightouts.filter(n => n.status === "Approved").length;
                const pendingNightouts = nightouts.filter(n => n.status === "Pending").length;

                document.getElementById('wardenDashboardCards').innerHTML = `
            <div class="card">
                <h3>üìã Pending Complaints</h3>
                <div class="card-number">${pendingComplaints}</div>
            </div>
            <div class="card">
                <h3>‚úÖ Resolved Complaints</h3>
                <div class="card-number">${resolvedComplaints}</div>
            </div>
            <div class="card">
                <h3>üö™ Students Out</h3>
                <div class="card-number">${studentsOut}</div>
            </div>
            <div class="card">
                <h3>‚è≥ Pending Night-outs</h3>
                <div class="card-number">${pendingNightouts}</div>
            </div>
        `;

                loadWardenAnnouncementsPreview();
                loadWardenRecentActivities();

            } catch (err) {
                console.error("Warden dashboard error:", err);
            }
        }

        function isLeaveCurrent(leave) {
            const now = new Date();
            const from = new Date(leave.from);
            const to = new Date(leave.to);
            return now >= from && now <= to;
        }

        document.getElementById('complaintForm')?.addEventListener('submit', async function (e) {
            e.preventDefault();

            if (!currentUser) {
                alert("Please login first");
                return;
            }



            const category = document.getElementById('complaintCategory').value;
            const priority = document.getElementById('complaintPriority').value;
            const description = document.getElementById('complaintDescription').value;

            if (!category || !priority || !description) {
                alert("Please fill all required fields");
                return;
            }

            try {
                const res = await fetch(`${API_BASE}/complaints`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        student_id: currentUser.id,
                        title: category,
                        description: description,
                        priority: priority
                    })
                });

                const data = await res.json();

                if (!res.ok) {
                    throw new Error(data.error || "Failed to submit complaint");
                }

                alert("Complaint submitted successfully");
                document.getElementById('complaintForm').reset();

                // reload complaints from DB
                loadStudentComplaints();

            } catch (err) {
                console.error(err);
                alert("Backend error while submitting complaint");
            }
        });


        async function loadStudentComplaints() {
            if (!currentUser) return;

            try {
                const res = await fetch(`${API_BASE}/complaints/${currentUser.id}`);
                const complaints = await res.json();

                if (!Array.isArray(complaints) || complaints.length === 0) {
                    document.getElementById('complaintsList').innerHTML =
                        '<div class="empty-state"><h3>No complaints found</h3></div>';
                    return;
                }

                const html = complaints.map(c => `
            <div class="list-item">
                <div class="list-item-content">
                    <h4>${c.title}</h4>
                    <p>${c.description}</p>
                    <p><strong>Priority:</strong> ${c.priority}</p>
                    <p>
                        <strong>Status:</strong>
                        <span class="status-badge status-${c.status.toLowerCase().replace(' ', '-')}">
                            ${c.status}
                        </span>
                    </p>
                    <p style="font-size: 12px;">
                        Submitted: ${new Date(c.created_at).toLocaleString()}
                    </p>
                </div>
            </div>
        `).join('');

                document.getElementById('complaintsList').innerHTML = html;

            } catch (err) {
                console.error(err);
                alert("Failed to load complaints");
            }
        }

        function filterComplaints() {
            loadStudentComplaints();
        }

        async function loadStudentActivityFeed() {
            if (!currentUser) return;

            let html = '';

            try {
                // ===== COMPLAINTS FROM DB =====
                const cRes = await fetch(`${API_BASE}/complaints/${currentUser.id}`);
                const complaints = await cRes.json();

                if (Array.isArray(complaints) && complaints.length > 0) {
                    html += complaints.slice(-3).map(c => `
                <div class="list-item">
                    <div class="list-item-content">
                        <h4>Complaint</h4>
                        <p>${c.title} - ${c.priority} Priority</p>
                        <p>
                            <span class="status-badge status-${c.status.toLowerCase().replace(' ', '-')}">
                                ${c.status}
                            </span>
                        </p>
                    </div>
                </div>
            `).join('');
                }

                // ===== NIGHT-OUT FROM DB =====
                const nRes = await fetch(`${API_BASE}/nightout/${currentUser.id}`);
                const nightouts = await nRes.json();

                if (Array.isArray(nightouts) && nightouts.length > 0) {
                    html += nightouts.slice(-3).map(n => `
                <div class="list-item">
                    <div class="list-item-content">
                        <h4>Night-out Request</h4>
                        <p>${new Date(n.from_date).toLocaleDateString()} ‚Üí ${new Date(n.to_date).toLocaleDateString()}</p>
                        <p>
                            <span class="status-badge status-${n.status.toLowerCase()}">
                                ${n.status}
                            </span>
                        </p>
                    </div>
                </div>
            `).join('');
                }

                if (!html) {
                    html = '<div class="empty-state"><h3>No recent activity</h3></div>';
                }

                document.getElementById('recentActivityList').innerHTML = html;

            } catch (err) {
                console.error("Activity feed error:", err);
                document.getElementById('recentActivityList').innerHTML =
                    '<div class="empty-state"><h3>Failed to load activity</h3></div>';
            }
        }

        function viewComplaintDetail(complaintId) {

            const complaint = complaints.find(c => c.id === complaintId);

            if (!complaint) return;

            let html = `
                <div class="form-group">
                    <p><strong>Complaint ID:</strong> ${complaint.id}</p>
                    <p><strong>Category:</strong> ${complaint.category}</p>
                    <p><strong>Priority:</strong> ${complaint.priority}</p>
                    <p><strong>Status:</strong> <span class="status-badge status-${complaint.status.toLowerCase().replace(' ', '-')}">${complaint.status}</span></p>
                    <p><strong>Description:</strong></p>
                    <p>${complaint.description}</p>
            `;

            if (complaint.image && userRole === 'student') {
                html += `<p><strong>Attached Image:</strong></p><img src="${complaint.image}" style="max-width: 100%; border-radius: 6px; margin-top: 10px;">`;
            }

            html += `</div>`;

            document.getElementById('complaintModalContent').innerHTML = html;
            document.getElementById('complaintModal').classList.add('active');
        }

        // ========== LEAVES ==========
        document.getElementById('leaveForm')?.addEventListener('submit', async function (e) {
            e.preventDefault();

            if (!currentUser) {
                alert("Please login first");
                return;
            }

            const from = document.getElementById('leaveFrom').value;
            const to = document.getElementById('leaveTo').value;
            const reason = document.getElementById('leaveReason').value;
            const parentContact = document.getElementById('leaveParentContact').value;

            if (!from || !to || !reason || !parentContact) {
                alert("Please fill all fields");
                return;
            }

            try {
                const res = await fetch(`${API_BASE}/nightout`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        student_id: currentUser.id,
                        student_name: currentUser.name,
                        from_date: from,
                        to_date: to,
                        reason: reason,
                        parent_contact: parentContact
                    })
                });

                const data = await res.json();
                if (!res.ok) throw new Error(data.error);

                alert("Night-out request submitted");
                document.getElementById('leaveForm').reset();

                loadStudentNightOuts();

            } catch (err) {
                console.error(err);
            }
        });


        async function loadStudentNightOuts() {
            if (!currentUser) return;

            try {
                const res = await fetch(`${API_BASE}/nightout/${currentUser.id}`);
                const leaves = await res.json();

                if (!leaves.length) {
                    document.getElementById('leavesList').innerHTML =
                        '<div class="empty-state"><h3>No night-out requests</h3></div>';
                    return;
                }

                const html = leaves.map(l => `
            <div class="list-item">
                <div class="list-item-content">
                    <h4>${new Date(l.from_date).toLocaleString()} ‚Üí ${new Date(l.to_date).toLocaleString()}</h4>
                    <p>${l.reason}</p>
                    <p><strong>Status:</strong>
                        <span class="status-badge status-${l.status.toLowerCase()}">
                            ${l.status}
                        </span>
                    </p>
                </div>
            </div>
        `).join('');

                document.getElementById('leavesList').innerHTML = html;

            } catch (err) {
                console.error(err);
                alert("Failed to load night-out requests");
            }
        }


        function approveLeave(leaveId) {
            const leaves = JSON.parse(localStorage.getItem('leaves')) || [];
            const leave = leaves.find(l => l.id === leaveId);

            if (!leave) return;

            leave.status = 'Approved';
            leave.approvedAt = new Date().toISOString();
            leave.approvedBy = currentUser.id;

            localStorage.setItem('leaves', JSON.stringify(leaves));
            addNotification('success', 'Leave Approved', `Leave request for ${leave.studentName} has been approved.`);
            loadWardenLeaves();
            renderWardenDashboard();
        }

        function rejectLeave(leaveId) {
            const leaves = JSON.parse(localStorage.getItem('leaves')) || [];
            const leave = leaves.find(l => l.id === leaveId);

            if (!leave) return;

            leave.status = 'Rejected';
            leave.rejectedAt = new Date().toISOString();
            leave.rejectedBy = currentUser.id;

            localStorage.setItem('leaves', JSON.stringify(leaves));
            addNotification('error', 'Leave Rejected', `Leave request for ${leave.studentName} has been rejected.`);
            loadWardenLeaves();
            renderWardenDashboard();
        }

        function filterWardenLeaves() {
            loadWardenLeaves();
        }

        // ========== ANONYMOUS REPORTS ==========
        function showAnonTooltip() {
            const tooltip = document.getElementById('anonTooltip');
            tooltip.style.display = tooltip.style.display === 'none' ? 'block' : 'none';
        }

        document.getElementById('anonForm')?.addEventListener('submit', function (e) {
            e.preventDefault();

            const type = document.getElementById('anonType').value;
            const description = document.getElementById('anonDescription').value;
            const evidenceFiles = document.getElementById('anonEvidenceFiles')?.files || [];

            if (!type || !description) {
                alert('Please fill all fields');
                return;
            }

            const reports = JSON.parse(localStorage.getItem('anonymousReports')) || [];

            // Process evidence files
            let evidenceArray = [];
            let filesProcessed = 0;

            const processFiles = () => {
                if (filesProcessed === evidenceFiles.length) {
                    // All files processed, create report
                    const report = {
                        id: 'ANON' + Date.now(),
                        type: type,
                        description: description,
                        evidence: evidenceArray, // Array of Base64 images
                        // NO student ID stored - completely anonymous
                        createdAt: new Date().toISOString(),
                        status: 'Submitted'
                    };

                    reports.push(report);
                    localStorage.setItem('anonymousReports', JSON.stringify(reports));

                    addNotification('success', 'Anonymous Report Submitted', 'Your report has been submitted safely.');
                    document.getElementById('anonForm').reset();
                    document.getElementById('anonEvidencePreview').innerHTML = '';
                    alert('Anonymous report submitted successfully. Your identity is protected.');
                }
            };

            if (evidenceFiles.length === 0) {
                processFiles();
            } else {
                Array.from(evidenceFiles).forEach((file, index) => {
                    if (file.size > 5 * 1024 * 1024) {
                        alert(`Evidence file ${index + 1} is too large (max 5MB)`);
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function (e) {
                        evidenceArray.push(e.target.result);
                        filesProcessed++;
                        processFiles();
                    };
                    reader.readAsDataURL(file);
                });
            }
        });

        // Add event listener for evidence file preview
        document.getElementById('anonEvidenceFiles')?.addEventListener('change', function (e) {
            const preview = document.getElementById('anonEvidencePreview');
            preview.innerHTML = '';

            Array.from(e.target.files).forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function (evt) {
                    const img = document.createElement('img');
                    img.src = evt.target.result;
                    img.style.maxWidth = '100px';
                    img.style.maxHeight = '100px';
                    img.style.borderRadius = '6px';
                    img.style.border = '2px solid var(--border-color)';
                    preview.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        });

        function loadWardenAnonymous() {
            const reports = JSON.parse(localStorage.getItem('anonymousReports')) || [];

            if (reports.length === 0) {
                document.getElementById('wardenAnonymousList').innerHTML = '<div class="empty-state"><h3>No anonymous reports</h3></div>';
                return;
            }

            const html = reports.map(report => `
                <div class="list-item">
                    <div class="list-item-content">
                        <h4>Anonymous Report - ${report.id}</h4>
                        <p><strong>Type:</strong> ${report.type}</p>
                        <p>${report.description.substring(0, 150)}...</p>
                        ${report.evidence && report.evidence.length > 0 ? `<p><strong>Evidence:</strong> ${report.evidence.length} file(s) attached</p>` : ''}
                        <p style="font-size: 12px;">Submitted: ${new Date(report.createdAt).toLocaleString()}</p>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn-sm btn-primary" onclick="viewAnonReport('${report.id}')">View Details</button>
                    </div>
                </div>
            `).join('');

            document.getElementById('wardenAnonymousList').innerHTML = html;
        }

        function viewAnonReport(reportId) {
            const reports = JSON.parse(localStorage.getItem('anonymousReports')) || [];
            const report = reports.find(r => r.id === reportId);

            if (!report) return;

            let html = `
                <div class="form-group">
                    <p><strong>Report ID:</strong> ${report.id}</p>
                    <p><strong>Type:</strong> ${report.type}</p>
                    <p><strong>Status:</strong> <span class="status-badge status-submitted">${report.status}</span></p>
                    <p><strong>Submitted:</strong> ${new Date(report.createdAt).toLocaleString()}</p>
                    <p><strong>Description:</strong></p>
                    <p style="background-color: var(--light-bg); padding: 10px; border-radius: 6px; border-left: 4px solid var(--warning-color);">${report.description}</p>
            `;

            if (report.evidence && report.evidence.length > 0) {
                html += `<p><strong>Evidence:</strong></p><div style="display: flex; gap: 10px; flex-wrap: wrap; margin: 10px 0;">`;
                report.evidence.forEach((img, idx) => {
                    html += `<img src="${img}" style="max-width: 150px; max-height: 150px; border-radius: 6px; border: 1px solid var(--border-color);">`;
                });
                html += `</div>`;
            }

            html += `</div>`;

            document.getElementById('complaintModalContent').innerHTML = html;
            document.getElementById('complaintModal').classList.add('active');
        }

        // ========== ESCORT REQUESTS ==========
        document.getElementById('escortForm')?.addEventListener('submit', async function (e) {
            e.preventDefault();

            if (!currentUser) {
                alert("Please login first");
                return;
            }

            const reason = document.getElementById('escortReason').value;
            const location = document.getElementById('escortLocation').value;
            const time = document.getElementById('escortTime').value;

            if (!reason || !location || !time) {
                alert("Please fill all fields");
                return;
            }

            try {
                const res = await fetch(`${API_BASE}/escorts`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        student_id: currentUser.id,
                        student_name: currentUser.name,
                        reason: reason,
                        location: location,
                        time: time
                    })
                });

                const data = await res.json();
                if (!res.ok) throw new Error(data.error || "Escort request failed");

                alert("Escort request submitted successfully");

                document.getElementById('escortForm').reset();

                // refresh student status page
                loadRequestStatus();

            } catch (err) {
                console.error("‚ùå Escort submit error:", err);
                alert("Failed to submit escort request");
            }
        });


        /* ================= WARDEN: LOAD ESCORT REQUESTS (FROM DB) ================= */
        async function loadWardenEscorts() {
            try {
                const res = await fetch(`${API_BASE}/escorts`);
                const escorts = await res.json();

                if (!Array.isArray(escorts) || escorts.length === 0) {
                    document.getElementById('wardenEscortsList').innerHTML =
                        '<div class="empty-state"><h3>No escort requests</h3></div>';
                    return;
                }

                const html = escorts.map(escort => `
            <div class="list-item">
                <div class="list-item-content">
                    <h4>${escort.student_name}</h4>
                    <p><strong>Reason:</strong> ${escort.reason}</p>
                    <p><strong>Destination:</strong> ${escort.location}</p>
                    <p><strong>Required Time:</strong> ${new Date(escort.time).toLocaleString()}</p>
                    <p>
                        <strong>Status:</strong>
                        <span class="status-badge status-${escort.status.toLowerCase()}">
                            ${escort.status}
                        </span>
                    </p>
                </div>

                <div class="list-item-actions">
                    ${escort.status === 'Pending' ? `
                        <button class="btn-sm btn-primary"
                            onclick="assignEscort(${escort.id})">
                            Assign
                        </button>
                    ` : ''}

                    ${escort.status === 'Assigned' ? `
                        <button class="btn-sm btn-success"
                            onclick="completeEscort(${escort.id})">
                            Complete
                        </button>
                    ` : ''}
                </div>
            </div>
        `).join('');

                document.getElementById('wardenEscortsList').innerHTML = html;

            } catch (err) {
                console.error("‚ùå Failed to load escort requests:", err);
                document.getElementById('wardenEscortsList').innerHTML =
                    '<div class="empty-state"><h3>Failed to load escort requests</h3></div>';
            }
        }


        /* ================= WARDEN: ASSIGN ESCORT ================= */
        async function assignEscort(escortId) {
            try {
                const res = await fetch(`${API_BASE}/escorts/${escortId}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ status: "Assigned" })
                });

                const data = await res.json();
                if (!res.ok) throw new Error(data.error || "Assign failed");

                addNotification(
                    "info",
                    "Escort Assigned",
                    `Escort request ${escortId} has been assigned`
                );

                loadWardenEscorts();

            } catch (err) {
                console.error("‚ùå Assign escort error:", err);
                alert("Failed to assign escort");
            }
        }


        /* ================= WARDEN: COMPLETE ESCORT ================= */
        async function completeEscort(escortId) {
            try {
                const res = await fetch(`${API_BASE}/escorts/${escortId}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ status: "Completed" })
                });

                const data = await res.json();
                if (!res.ok) throw new Error(data.error || "Complete failed");

                addNotification(
                    "success",
                    "Escort Completed",
                    `Escort request ${escortId} has been completed`
                );

                loadWardenEscorts();

            } catch (err) {
                console.error("‚ùå Complete escort error:", err);
                alert("Failed to complete escort");
            }
        }


        // ========== STUDENT PROFILE ==========
        function loadStudentProfile() {
            const user = currentUser;

            let photoHtml = '';
            if (user.profilePicture) {
                photoHtml = `<img src="${user.profilePicture}" alt="Profile" class="profile-photo" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover;">`;
            } else {
                photoHtml = `<div style="width: 120px; height: 120px; border-radius: 50%; background-color: var(--secondary-color); display: flex; align-items: center; justify-content: center; color: var(--white); font-size: 48px;">üë§</div>`;
            }

            let idProofHtml = '';
            if (user.idProof) {
                idProofHtml = `
                    <button class="collapsible-header" onclick="toggleCollapsible(event)">üìÑ View ID Proof</button>
                    <div class="collapsible-content">
                        <img src="${user.idProof}" alt="ID Proof" style="max-width: 100%; border-radius: 6px;">
                    </div>
                `;
            }

            const html = `
                <div class="profile-header">
                    <div style="text-align: center;">
                        ${photoHtml}
                        <div style="margin-top: 15px;">
                            <input type="file" id="profilePictureInput" accept="image/*" style="display: none;">
                            <button class="btn-primary btn-sm" onclick="document.getElementById('profilePictureInput').click()">Upload Photo</button>
                        </div>
                    </div>
                    <div class="profile-info">
                        <h2>${user.name}</h2>
                        <p><strong>Student ID:</strong> ${user.id}</p>
                        <p><strong>Email:</strong> ${user.email}</p>
                        <p><strong>Date of Birth:</strong> ${user.dob ? new Date(user.dob).toLocaleDateString() : 'N/A'}</p>
                        <p><strong>Phone:</strong> ${user.phone}</p>
                        <p><strong>College:</strong> ${user.college}</p>
                        <p><strong>Department:</strong> ${user.department}</p>
                        <p><strong>Room Number:</strong> ${user.roomNumber}</p>
                    </div>
                </div>
                <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--border-color);">
                <div>
                    <p><strong>Parent Name:</strong> ${user.parentName}</p>
                    <p><strong>Parent Contact:</strong> ${user.parentContact}</p>
                    <p><strong>Registration Date:</strong> ${new Date(user.registeredAt).toLocaleString()}</p>
                </div>
                <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--border-color);">
                ${idProofHtml}
            `;

            document.getElementById('studentProfileContent').innerHTML = html;

            // Add event listener for profile picture upload
            const profileInput = document.getElementById('profilePictureInput');
            if (profileInput) {
                profileInput.addEventListener('change', uploadProfilePicture);
            }
        }

        // ========== WARDEN PROFILE ==========
        function loadWardenProfile() {
            const user = currentUser;

            let photoHtml = '';
            if (user.profilePicture) {
                photoHtml = `<img src="${user.profilePicture}" alt="Profile" class="profile-photo" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover;">`;
            } else {
                photoHtml = `<div style="width: 120px; height: 120px; border-radius: 50%; background-color: var(--secondary-color); display: flex; align-items: center; justify-content: center; color: var(--white); font-size: 48px;">üë§</div>`;
            }

            let idProofHtml = '';
            if (user.idCardImage) {
                idProofHtml = `
                    <button class="collapsible-header" onclick="toggleCollapsible(event)">üìÑ View Employee ID</button>
                    <div class="collapsible-content">
                        <img src="${user.idCardImage}" alt="Employee ID Card" style="max-width: 100%; border-radius: 6px;">
                    </div>
                `;
            }

            const html = `
                <div class="profile-header">
                    <div style="text-align: center;">
                        ${photoHtml}
                        <div style="margin-top: 15px;">
                            <input type="file" id="wardenProfilePictureInput" accept="image/*" style="display: none;">
                            <button class="btn-primary btn-sm" onclick="document.getElementById('wardenProfilePictureInput').click()">Upload Photo</button>
                        </div>
                    </div>
                    <div class="profile-info">
                        <h2>${user.name}</h2>
                        <p><strong>Employee ID:</strong> ${user.id}</p>
                        <p><strong>Email:</strong> ${user.email}</p>
                        <p><strong>Date of Birth:</strong> ${user.dob ? new Date(user.dob).toLocaleDateString() : 'N/A'}</p>
                        <p><strong>Phone:</strong> ${user.phone}</p>
                        <p><strong>Registration Date:</strong> ${new Date(user.registeredAt).toLocaleString()}</p>
                    </div>
                </div>
                <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--border-color);">
                ${idProofHtml}
            `;

            document.getElementById('wardenProfileContent').innerHTML = html;

            // Add event listener for profile picture upload
            const profileInput = document.getElementById('wardenProfilePictureInput');
            if (profileInput) {
                profileInput.addEventListener('change', uploadWardenProfilePicture);
            }
        }

        function uploadWardenProfilePicture(e) {
            const file = e.target.files[0];
            if (!file) return;

            if (file.size > 5 * 1024 * 1024) {
                alert('Image file size should be less than 5MB');
                return;
            }

            const reader = new FileReader();
            reader.onload = function (evt) {
                currentUser.profilePicture = evt.target.result;

                // Update in localStorage
                const users = JSON.parse(localStorage.getItem('users')) || [];
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex] = currentUser;
                    localStorage.setItem('users', JSON.stringify(users));
                }

                addNotification('success', 'Profile Picture', 'Your profile picture has been updated successfully.');
                loadWardenProfile();
            };
            reader.readAsDataURL(file);
        }

        function uploadProfilePicture(e) {
            const file = e.target.files[0];
            if (!file) return;

            if (file.size > 5 * 1024 * 1024) {
                alert('Image file size should be less than 5MB');
                return;
            }

            const reader = new FileReader();
            reader.onload = function (evt) {
                currentUser.profilePicture = evt.target.result;

                // Update in localStorage
                const users = JSON.parse(localStorage.getItem('users')) || [];
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex] = currentUser;
                    localStorage.setItem('users', JSON.stringify(users));
                }

                addNotification('success', 'Profile Picture', 'Your profile picture has been updated successfully.');
                loadStudentProfile();
            };
            reader.readAsDataURL(file);
        }

        function toggleCollapsible(event) {
            event.target.nextElementSibling.classList.toggle('active');
        }
        //WARDEN LEAVES
        async function loadWardenLeaves() {
            try {
                const res = await fetch(`${API_BASE}/nightout`);
                const leaves = await res.json();

                if (!Array.isArray(leaves) || leaves.length === 0) {
                    document.getElementById('wardenLeavesList').innerHTML =
                        '<div class="empty-state"><h3>No night-out requests</h3></div>';
                    return;
                }

                const html = leaves.map(leave => `
      <div class="list-item">
        <div class="list-item-content">
          <h4>${leave.student_name || "Student ID: " + leave.student_id}</h4>
          <p><strong>From:</strong> ${new Date(leave.from_date).toLocaleString()}</p>
          <p><strong>To:</strong> ${new Date(leave.to_date).toLocaleString()}</p>
          <p><strong>Reason:</strong> ${leave.reason}</p>
          <p>
            <strong>Status:</strong>
            <span class="status-badge status-${leave.status.toLowerCase()}">
              ${leave.status}
            </span>
          </p>
        </div>
        <div class="list-item-actions">
          ${leave.status === "Pending" ? `
            <button class="btn-sm btn-success"
              onclick="updateNightoutStatus('${leave.id}', 'Approved')">
              Approve
            </button>
            <button class="btn-sm btn-danger"
              onclick="updateNightoutStatus('${leave.id}', 'Rejected')">
              Reject
            </button>
          ` : ''}
        </div>
      </div>
    `).join('');

                document.getElementById('wardenLeavesList').innerHTML = html;

            } catch (err) {
                console.error("‚ùå Load warden leaves error:", err);
                document.getElementById('wardenLeavesList').innerHTML =
                    '<div class="empty-state"><h3>Failed to load night-out requests</h3></div>';
            }
        }
        //update night out status
        async function updateNightoutStatus(id, status) {
            try {
                const res = await fetch(`${API_BASE}/nightout/${id}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ status })
                });

                const data = await res.json();
                if (!res.ok) throw new Error(data.error);

                alert(`Night-out ${status}`);
                loadWardenLeaves();        // refresh list
                renderWardenDashboard();  // refresh counters

            } catch (err) {
                console.error(err);
                alert("Failed to update night-out request");
            }
        }

        // ========== COMPLAINTS (WARDEN) ==========
        async function loadWardenComplaints() {
            try {
                const statusFilter =
                    document.getElementById('wardenComplaintFilter')?.value || '';

                const res = await fetch(`${API_BASE}/complaints`);
                let complaints = await res.json();

                if (!Array.isArray(complaints)) complaints = [];

                if (statusFilter) {
                    complaints = complaints.filter(c => c.status === statusFilter);
                }

                if (complaints.length === 0) {
                    document.getElementById('wardenComplaintsList').innerHTML =
                        '<div class="empty-state"><h3>No complaints</h3></div>';
                    return;
                }

                const html = complaints.map(c => `
            <div class="list-item">
                <div class="list-item-content">
                    <h4>${c.title}</h4>
                    <p><strong>Student ID:</strong> ${c.student_id}</p>
                    <p>
                        <strong>Priority:</strong> ${c.priority} |
                        <strong>Status:</strong>
                        <span class="status-badge status-${c.status.toLowerCase().replace(' ', '-')}">
                            ${c.status}
                        </span>
                    </p>
                    <p>${c.description.substring(0, 100)}...</p>
                </div>
                <div class="list-item-actions">
                     <button class="btn-sm btn-primary"
    onclick="updateComplaintStatus('${c.id}', 'In Progress')">
    In Progress
</button>
<button class="btn-sm btn-success"
    onclick="updateComplaintStatus('${c.id}', 'Resolved')">
    Resolve
</button>

                    
                    
                </div>
            </div>
        `).join('');

                document.getElementById('wardenComplaintsList').innerHTML = html;

            } catch (err) {
                console.error(err);
                alert("Failed to load complaints");
            }
        }

        async function updateComplaintStatus(complaintId, newStatus) {
            try {
                const res = await fetch(
                    `${API_BASE}/complaints/${complaintId}`,
                    {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ status: newStatus })
                    }
                );

                const data = await res.json();

                if (!res.ok) {
                    throw new Error(data.error || "Failed to update complaint");
                }

                addNotification(
                    newStatus === "Resolved" ? "success" : "info",
                    "Complaint Updated",
                    `Complaint marked as ${newStatus}`
                );

                // üîÑ Refresh everything that depends on complaints
                loadWardenComplaints();
                renderWardenDashboard();
                loadStudentComplaints();

            } catch (err) {
                console.error(err);
                alert("Failed to update complaint status");
            }
        }

        function filterWardenComplaints() {
            loadWardenComplaints();
        }

        // ========== PAYMENT STATUS ==========
        function loadPaymentStatus() {
            const user = currentUser;
            const html = `
                <div class="card">
                    <h3>Hostel Fee Information</h3>
                    <p><strong>Remaining Amount Due:</strong> <span style="font-size: 24px; color: var(--danger-color);">‚Çπ${user.remainingFee.toFixed(2)}</span></p>
                    <p style="margin-top: 10px; font-size: 13px;">Please contact the hostel office for payment details and modes.</p>
                </div>
            `;
            document.getElementById('paymentContent').innerHTML = html;
        }

        // ========== ANNOUNCEMENTS ==========
        document.getElementById('announcementForm')?.addEventListener('submit', function (e) {
            e.preventDefault();

            const title = document.getElementById('announcementTitle').value;
            const text = document.getElementById('announcementText').value;

            if (!title || !text) {
                alert('Please fill all fields');
                return;
            }

            const announcements = JSON.parse(localStorage.getItem('announcements')) || [];

            const announcement = {
                id: 'ANN' + Date.now(),
                title: title,
                text: text,
                postedBy: currentUser.name,
                postedAt: new Date().toISOString()
            };

            announcements.push(announcement);
            localStorage.setItem('announcements', JSON.stringify(announcements));

            document.getElementById('announcementForm').reset();
            loadAnnouncements();
            alert('Announcement posted successfully.');
        });

        function loadAnnouncements() {
            const announcements = JSON.parse(localStorage.getItem('announcements')) || [];

            if (announcements.length === 0) {
                document.getElementById('announcementsList').innerHTML = '<div class="empty-state"><h3>No announcements yet</h3></div>';
                return;
            }

            const html = announcements.reverse().map(ann => `
                <div class="notification info">
                    <div class="notification-content">
                        <h4>${ann.title}</h4>
                        <p>${ann.text}</p>
                        <p style="font-size: 12px; margin-top: 10px;">Posted by ${ann.postedBy} on ${new Date(ann.postedAt).toLocaleString()}</p>
                    </div>
                </div>
            `).join('');

            document.getElementById('announcementsList').innerHTML = html;
        }

        function loadAnnouncementsPreview() {
            const announcements = JSON.parse(localStorage.getItem('announcements')) || [];

            if (announcements.length === 0) {
                document.getElementById('announcementsPreview').innerHTML = '<div class="empty-state"><p>No announcements</p></div>';
                return;
            }

            // Show only the latest single announcement (no truncation on preview)
            const latestAnn = announcements[announcements.length - 1];
            const html = `
                <div class="notification info" style="margin-bottom: 10px;">
                    <div class="notification-content">
                        <h4>${latestAnn.title}</h4>
                        <p style="font-size: 13px;">${latestAnn.text}</p>
                        <p style="font-size: 12px; margin-top: 8px;">Posted on ${new Date(latestAnn.postedAt).toLocaleString()}</p>
                    </div>
                </div>
            `;

            document.getElementById('announcementsPreview').innerHTML = html;
        }

        function loadAllAnnouncements() {
            const announcements = JSON.parse(localStorage.getItem('announcements')) || [];

            if (announcements.length === 0) {
                document.getElementById('announcementsFullList').innerHTML = '<div class="empty-state"><h3>No announcements yet</h3></div>';
                return;
            }

            const html = announcements.reverse().map(ann => `
                <div class="notification info">
                    <div class="notification-content">
                        <h4>${ann.title}</h4>
                        <p>${ann.text}</p>
                        <p style="font-size: 12px; margin-top: 10px;">Posted on ${new Date(ann.postedAt).toLocaleString()}</p>
                    </div>
                </div>
            `).join('');

            document.getElementById('announcementsFullList').innerHTML = html;
        }

        // Load latest announcement for warden dashboard preview
        function loadWardenAnnouncementsPreview() {
            const announcements = JSON.parse(localStorage.getItem('announcements')) || [];

            if (announcements.length === 0) {
                document.getElementById('wardenAnnouncementsPreview').innerHTML = '<div class="empty-state"><p>No announcements</p></div>';
                return;
            }

            // Show only the latest single announcement (no truncation)
            const latestAnn = announcements[announcements.length - 1];
            const html = `
                <div class="notification info" style="margin-bottom: 10px;">
                    <div class="notification-content">
                        <h4>${latestAnn.title}</h4>
                        <p style="font-size: 13px;">${latestAnn.text}</p>
                        <p style="font-size: 12px; margin-top: 8px;">Posted on ${new Date(latestAnn.postedAt).toLocaleString()}</p>
                    </div>
                </div>
            `;

            document.getElementById('wardenAnnouncementsPreview').innerHTML = html;
        }

        // ========== NOTIFICATIONS ==========
        function addNotification(type, title, message) {
            const notifications = JSON.parse(localStorage.getItem('notifications')) || [];

            const notification = {
                id: 'NOTIF' + Date.now(),
                type: type,
                title: title,
                message: message,
                createdAt: new Date().toISOString(),
                read: false
            };

            notifications.push(notification);
            localStorage.setItem('notifications', JSON.stringify(notifications));

            renderNotifications();
        }

        function renderNotifications() {
            const notifications = JSON.parse(localStorage.getItem('notifications')) || [];
            const recentNotifications = notifications.slice(-5);

            if (recentNotifications.length === 0) {
                document.getElementById('notificationsContainer').innerHTML = '';
                return;
            }

            const html = recentNotifications.map(notif => `
                <div class="notification ${notif.type}">
                    <div class="notification-content">
                        <h4>${notif.title}</h4>
                        <p>${notif.message}</p>
                    </div>
                    <button class="close-btn" onclick="removeNotification('${notif.id}')">&times;</button>
                </div>
            `).join('');

            document.getElementById('notificationsContainer').innerHTML = html;
        }

        function removeNotification(notifId) {
            const notifications = JSON.parse(localStorage.getItem('notifications')) || [];
            const filtered = notifications.filter(n => n.id !== notifId);
            localStorage.setItem('notifications', JSON.stringify(filtered));
            renderNotifications();
        }

        // ========== MODAL FUNCTIONS ==========
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // ========== INITIALIZATION ==========
        window.addEventListener('load', function () {
            initializeApp();
            seedAnnouncementsIfEmpty();
            applyAccessibilitySettings();
            updateUI();

            // Update register prompt visibility on login page
            if (document.getElementById('loginPage').classList.contains('active')) {
                if (userRole === 'student') {
                    document.getElementById('registerPromptStudent').style.display = 'block';
                    document.getElementById('registerPromptWarden').style.display = 'none';
                } else if (userRole === 'warden') {
                    document.getElementById('registerPromptStudent').style.display = 'none';
                    document.getElementById('registerPromptWarden').style.display = 'block';
                }
            }
        });

        // Seed demo announcements if empty
        function seedAnnouncementsIfEmpty() {
            const announcements = JSON.parse(localStorage.getItem('announcements')) || [];
            if (announcements.length === 0) {
                const demoAnnouncements = [
                    {
                        id: 'ANN1001',
                        title: 'Welcome to Digital Hostel Management',
                        text: 'We are excited to launch our new digital hostel management system. This system will help streamline complaints, leave requests, and hostel operations.',
                        postedBy: 'Mr. Rajesh Kumar',
                        postedAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString()
                    },
                    {
                        id: 'ANN1002',
                        title: 'Maintenance Schedule - Water Tank Cleaning',
                        text: 'The water tank cleaning will be done on Saturday from 10 AM to 2 PM. Students are advised to collect drinking water in advance.',
                        postedBy: 'Mr. Rajesh Kumar',
                        postedAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString()
                    },
                    {
                        id: 'ANN1003',
                        title: 'New Guest Room Booking Policy',
                        text: 'Effective from next month, guest room bookings must be made 48 hours in advance through the hostel management portal. A deposit of ‚Çπ500 is required.',
                        postedBy: 'Mr. Rajesh Kumar',
                        postedAt: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString()
                    }
                ];
                localStorage.setItem('announcements', JSON.stringify(demoAnnouncements));
            }
        }

        // Ensure localStorage is available
        function checkLocalStorageSupport() {
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                return true;
            } catch (e) {
                alert('localStorage is not available. The application requires localStorage to function.');
                return false;
            }
        }

        if (!checkLocalStorageSupport()) {
            document.body.innerHTML = '<div style="padding: 40px; text-align: center; color: red;"><h1>Error</h1><p>This browser does not support localStorage. Please use a different browser.</p></div>';
        }
    </script>
</body>

</html>